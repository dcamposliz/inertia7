<!DOCTYPE html>
<html>
<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, maximum-scale=1">
<meta name="description" content="Inertia7 is a platform for sharing data science projects.">
<meta name="keywords" content="R, Python, SQL, HTML, CSS, JavaScript, Data Science, Statistical Learning">
<meta name="author" content="David A. Campos, Raul Eulogio">

<meta property="og:title" content="Inertia7: Data Science Projects"/>
<meta property="og:image" content="http://www.inertia7.com/img/neuralNetork_purple_100_black_75.jpg"/>
<meta property="og:url" content="http://www.inertia7.com"/>
<meta property="og:description" content="Inertia7 is a platform for sharing data science projects."/>

<meta name="twitter:card" content="summary">
<meta name="twitter:url" content="http://www.inertia7.com">
<meta name="twitter:title" content="Inertia7: Dtaa Science Projects">
<meta name="twitter:description" content="Inertia7 is a platform for sharing data science projects.">
<meta name="twitter:image" content="http://www.inertia7.com/ img/neuralNetork_purple_100_black_75.jpg">

<link rel="publisher" href="https://www.davidacampos.com"/>

<title>Inertia7: Data Science Projects</title>
<link rel="icon" href="../favicon2.png" type="image/png">
<link rel="shortcut icon" href="../favicon2.ico" type="img/x-icon">

<link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,800italic,700italic,600italic,400italic,300italic,800,700,600' rel='stylesheet' type='text/css'>

<link href="../css/bootstrap.css" rel="stylesheet" type="text/css">
<link href="../css/style.css" rel="stylesheet" type="text/css">
<link href="../css/font-awesome.css" rel="stylesheet" type="text/css">
<link href="../css/responsive.css" rel="stylesheet" type="text/css">
<link href="../css/animate.css" rel="stylesheet" type="text/css">
<link href="../css/d3_style.css" rel="stylesheet" type="text/css">
<!--[if IE]><style type="text/css">.pie {behavior:url(PIE.htc);}</style><![endif]-->

<script type="text/javascript" src="../js/jquery.1.8.3.min.js"></script>
<script type="text/javascript" src="../js/bootstrap.js"></script>
<script type="text/javascript" src="../js/jquery-scrolltofixed.js"></script>
<script type="text/javascript" src="../js/jquery.easing.1.3.js"></script>
<script type="text/javascript" src="../js/jquery.isotope.js"></script>
<script type="text/javascript" src="../js/wow.js"></script>
<script type="text/javascript" src="../js/classie.js"></script>
<script type="text/javascript" src="../engines/scripts.js"></script>
<script src="http://cdn.plot.ly/plotly-latest.min.js"></script>

<!--[if lt IE 9]>
    <script src="js/respond-1.1.0.min.js"></script>
    <script src="js/html5shiv.js"></script>
    <script src="js/html5element.js"></script>
<![endif]-->

</head>
<body>

<div style="overflow:hidden;">

<div style="float:left; margin-top:3%; margin-left:7%">
    <a href="../index.html" style="color:white; font-family: 'Montserrat', sans-serif; font-size: 1.5em;">INERTIA7</a>
</div>

<header class="header" id="regression_bostonHousing">
<br />
<br />
    <div class="container"> 
            <h1 class="animated fadeInDown delay-07s">MODELING HOME PRICES</h1>
            <ul class="we-create animated fadeInUp delay-1s">
                <li><strong>Regression Analysis</strong> of <strong>Boston Home Prices</strong> with <strong>R</strong></li>
            </ul>
    </div>
</div>
</header>

<!-- PROJECT SUMMARY -->
    <section id="summary" class="main-section xlarge-paragraph" style="margin-top: 2em">
        <div class="container">
            <h2>Project Summary</h2>
            <h3>Abstract</h3>
            <div id="abstract">
                <p>This project focuses on finding the best statistical-learning model to predict future values for the <strong>S&P 500 Stock Index</strong>.
</p><p>
</p><p>Understanding the <strong>S&P 500 Stock Index</strong> is highly-relevant in understanding the health of the U.S. economy as it is highly-correlated (statistically) with other U.S. economic indicators such as other stock indices (e.g. the NASDAQ Stock Index and the NYSE Stock Exchange), the U.S. Housing Price Index, and the U.S. Gross Domestic Product (U.S. GDP).
</p><p>
</p><p>Time-series analysis is a basic concept within the field of statistical-learning, which is appropriate for the analysis of the <strong>S&P 500 Stock Index.</strong>
</p><p>
</p><p>For this project we leverage the horse-power of Python and deliver, where appropriate, gorgeous data visualizations using matplotlib.
</p><p>
</p><p>We encourage you to try replicating this project and make your own contributions! You can fork this project on <a href="https://github.com/inertia7/timeSeries_sp500_python">GitHub</a>.</p>
            </div>
        </div>
        <!-- Requirements: Only shown if defined -->
        
        <div class="container xlarge-paragraph">
            <h3>Requirements</h3>
            <ul>
    <li>Basic working knowledge of the Python programming language, statistics, and economics. If you need context in Python we recommend that you visit <a href="https://www.datacamp.com/">DataCamp</a>. </li>
    <li>Python 2.7.</li>
</ul>
        </div>
        
        <div class="container xlarge-paragraph">
            <h3>Steps</h3>
            <ul>
                
                <li><a href="#step1">1. Load modules</a></li>
                
                <li><a href="#step2">2. Get Data</a></li>
                
                <li><a href="#step3">3. Do Exploratory Analysis</a></li>
                
                <li><a href="#step4">4. Differencing the Time Series</a></li>
                
                <li><a href="#step5">5. Build Models</a></li>
                
                <li><a href="#step6">6. Forecast</a></li>
                
            </ul>
        </div>
        <div class="container xlarge-paragraph">
            <h3>Contributors</h3>
            <ul>
                
                <li>Raul Eulogio</li>
                
                <li> David A. Campos</li>
                
                <li> Vincent La</li>
                
            </ul>
        </div>
    </section>
    <!-- Main content -->
    <div id="project-writeup" class="container">
        <section class='main-section xlarge-paragraph'>
<h1 id='step1'><a href='#step1'>1. Load modules</a></h1>
<p>First, we want to load the appropriate modules into our python environment. It is important to note that I am using an Ubuntu termninal to run my py script!</p>
<p>For this we use the from method and include the function names as arguments. Make sure to first install the modules using the import method if you haven't done so already.</p>
<pre><code>
import pandas as pd
import numpy as np 
import statsmodels.api as sm  
from statsmodels.tsa.arima_model import ARIMA, ARIMAResults # Here we are calling up a specific function in the modules provided for time series analysis! 
from statsmodels.tsa.stattools import acf, pacf
from statsmodels.graphics.tsaplots import plot_acf, plot_pacf 
import matplotlib.pylab as plt 
import csv
import matplotlib.dates as dates
from matplotlib.pylab import rcParams
rcParams['figure.figsize'] = 15, 6
</code></pre>
                
<p>We encourage you to do a quick search on each of these modules to gain context on what they are useful for, and why we are using them here. Pay special attention to the modules <code>pandas</code> and <code>statsmodels.tsa</code></p>
</section>

<section class='main-section xlarge-paragraph'>
<h1 id='step2'><a href='#step2'>2. Get Data</a></h1>
<h2>Collecting Data</h2>
<p>
This is the same explanation as what we put in the R time series analysis. Now we collect our data. We want to use reliable sources of complete and accurate data. We collected 21 years (1995-2015) of S 500 Stock Index data at a monthly frequency (a total of 252 observations) from Yahoo Finance. You can do the same too.</p>

<h2>Cleaning Data</h2>
<p>We cleaned our data manually using Google Sheets. For this we made sure that all fields contained data (i.e. no missing values) and that the headers (i.e. column names) were labeled appropriately. This can be done programmatically with python, but this is outside of the scope of this project.</p>

<h2>Loading Data</h2>
<p>Then we must include our data set within our working python environment. For this we use:</p>
            
<pre><code>dataMaster = pd.read_csv('ts.csv')</code></pre>
            
<p>Now we can call our S 500 Stock Index data by typing <code>sp_500 =  dataMaster['sp_500']</code> into our terminal. Then we can call our object to make sure it does what a time series object should!</p>
<pre><code>print ts.head(12) # Prints the first 12 observations aka first year!</code>
</pre>
<p>Next we can call up a specific year to be sure the object understands what we are asking from it since there is no specific year except when created with the <code>ran</code>object</p><pre><code>print "Here is the year 2014
print ts['2014']</code></pre>
</section>
<section class='main-section xlarge-paragraph'><h1 id='step3'><a href='#step3'>3. Do Exploratory Analysis</a></h1>
<p>Now we want to get a feel for our data to get an intuition about the models that may be appropriate for our forecast. For this, we plot our data and diagnose for trend, seasonality, heteroskedasticity, and stationarity. We go over these concepts in further detail in this section.</p>
<h2>Creating time-series data object</h2>
<p> Our S 500 Stock Index data is in the form of time-series; this means that our data exists over a continuous time interval with equal spacing between every two consecutive measurements. In python we are able to create time-series objects for our data vectors using the <code>pd.Series()</code> method in the <code>pandas.</code> module. For this, we select the date range we would like to use by specifying the start and end times, and tune the <code>start = '1995-1'</code>, <code>end = '2016-1'</code>and <code>freq = 'M'</code> (frequency) parameters. Finally outputting <code>ran = pd.date_range('1995-1', '2016-1', freq = 'M')</code>Then we output the time-series object to the terminal by calling our newly-created time-series object.</p>
<pre><code>ts = pd.Series(dataMaster['sp_500'].values, index = ran)</code></pre>
<p>Then we output the time-series data to the terminal by calling our newly-created time-series object. Notice the nicely formatted data broken down into years and their respective months.</p>
<pre><code>print ts</code></pre>
<img src='/static/oh-no-i-have-ashma/timSeriesobject.png'>
<h3>Plotting Our Time-Series</h3>
<p>Plotting the data is arguably the most critical step in the exploratory analysis phase. This enables us to make inferences about important components of the time-series data, such as trend, seasonality, heteroskedasticity, and stationarity. Here is a quick summary of each:</p>
<ul>
<li><strong>Trend:</strong> we say that a dataset has a trend when it has either a long-term increase or decrease.</li>
<li><strong>Seasonality:</strong> we say that a dataset has seasonality when it has patterns that repeat over known, fixed periods of time (e.g. monthly, quarterly, yearly).</li>
<li><strong>Heteroskedasticity:</strong> we say that a data is heteroskedastic when its variability is not constant (i.e. its variance increases or decreases as a function of the explanatory variable).
<li><strong>Stationarity:</strong> a stochastic process is called stationary if the mean and variance are constant (i.e. their joint distribution does not change over time).</li>
</ul>
<p>We can plot our <code>ts</code> data object in python using the <code>matplotlib</code> method.</p>
<pre><code>plt.plot(ts) # Recall we imported matplotlib as plt!</code></pre>
<img src='/static/oh-no-i-have-ashma/plot_1.png'>
<p>We can quickly see that over the long-term our time-series has a positive trend.</p>
<p>Using <a href='https://plot.ly/javascript/'>plotly.js</a> and a bit of JavaScript knowledge we can produce a gorgeous data visualization onto our browser.</p>
<h3>Decomposing our time-series</h3>
<p>Under construction please wait for new iteration</p>
<pre><code># Plotting Seasonal Decomposition 
# res = seasonal_decompose(sp_500)
# des = res.plot()
# des.savefig("images/seasonalDecomp.png", format = 'png')
# des.close()</code></pre>
</section>
<section class='main-section xlarge-paragraph'>
<h3>Plotting ACF and PACF</h3>
<p> The ACF and PACF diagnosis is employed over a time-series to determine whether it has statistical stationarity. Loosely speaking, a time-series is stationary when its mean, variance, and autocorrelation remain constant over time. ACF stands for "autocorrelation function" and PACF stands for "partial autocorrelation function".

These functions help us understand the correlation component of different data points at different time lags. Lag refers to the time difference between one observation and a previous observation in a dataset. 

we use the functions <code>plot_acf</code> and <code>plot_pacf</code> in the <code>statsmodel.graphics.tsaplots</code> module!
</p>
<pre><code>acf = plot_acf(ts, lags = 20)
acf.savefig("images/timeSeriesACF.png", format = 'png') # Here I save the image unto a designated 
</code></pre>
<p>Next we do the PACF in a similar pattern</p><pre><code>pacf = plot_pacf(ts, lags = 20)
pacf.savefig("images/timeSeriesPACF.png", format = 'png')</code></pre>
<p>Its obvious from the graph and the acf and pacf plots that we will need to difference the time series object to remove upward trend!</p>
</section>
<section class='main-section xlarge-paragraph'>
<h1 id='step4'><a href='#step4'>4. Differencing the Time Series</a></h1>
<p>So we understand that there is upward trend so we decided to take the first difference to create a stationary time series in order to not violate our ARIMA assumptions. We did this as follows:</p><pre><code>sp500_diff = ts - ts.shift()
diff = sp500_diff.dropna() # We have to do this because when we take the difference we are left with a blank as the first value.</code></pre>
</section>
<section class='main-section xlarge-paragraph'><h3>Diagnosing our ARIMA Model from ACF and PACF plots</h3>
<p>After we had done the necessary transformation we look at the new ACF and PACF plots in hopes of estimating our would be ARIMA model. Here I included both on the same section since its the same process.</p>
<pre><code>acfDiff = plot_acf(diff, lags = 20)
acfDiff.savefig("images/timeSeriesACFDiff.png", format = 'png')

pacfDiff = plot_pacf(diff, lags = 20)
pacfDiff.savefig("images/timeSeriesPACFDiff.png", format = 'png') 
</code></pre><p>From these plots we deduce that our model would be MA(1), but since we took a transformation it would be a mixed ARIMA(0, 1, 1) model!</p>
</section>
<section class='main-section xlarge-paragraph'><h1 id='step5'><a href='#step5'>5. Build Models</a></h1>
<p>Here we create a model using the ARIMA function.</p>
<pre><code>mod = ARIMA(sp500_TR, order = (0, 1, 1), freq = 'M')
</code></pre>
<p>Here we print some logistics to see if our model came out and what not!</p>
<pre><code>print "Our model summary"
results = mod.fit()
print results.summary()</code></pre>
<p>Here we output the respective residual diagnostics</p>
</section>
<section class='main-section xlarge-paragraph'><h1 id='step6'><a href='#step6'>6. Forecast</a></h1>
<p>Now that we have our model we forecast on a training set of the years 1995 to 2014.</p>
<pre><code> print "Our predicted Values using predict on our ARIMA model!"
print results.predict(239, 251, typ='levels')
</code></pre><p>It is important to note that we used the <code>typ</code>parameter in our predict function because if we did not it would output the forecast values for the differenced time series object! Next some cleaning up and merging of dataframes to print a plot that has the real vs. forecasted values.</p>
<pre><code>predVals = results.predict(239, 251, typ='levels')
</code></pre><p>An issue I faced was that when predicted it predicted Dec 2014 too and when I tried to change the index I would get an error so I manually dropped the value using dop from pandas!</p>
<pre><code>predVals = predVals.drop(predVals.index[0])
print "Here are our predicted values!!!!!"
print predVals</code></pre>
<p>Now the ugly process of combining data frames to plot them!</p>
<pre><code>concan = pd.concat([ts, predVals], axis = 1, keys=['original', 'predicted'])
print "The data frame including the predicted values using ARIMA!"
print concan['2014':'2015']</code></pre><p>All that is left is to plot the figure that gets outputted by this dataframe!</p>
<pre><code>ax = concan.plot()
fig = ax.get_figure()
fig.savefig('images/predVAct.png')</code></pre>
<p>Lastly we can give a zoomed in view of our image to get a better view of the forecasting capabilites!</p>
<pre><code>ax1 = concan.plot()
ax1.axis(['2014-06-30', '2016', 1800, 2200])
fig1 = ax1.get_figure()
fig1.savefig('images/predVActZoom.png')</code></pre>
</section>
        </div>
    <!-- End main content -->
    <!-- Congrats -->
    <section class="main-section">
        <div class="container">
        <p>Congratulations for getting this far! We hope you enjoyed this project. Please reach out to us here if you have any feedback or would like to publish your own project.</p>
        </div>
    </section>
    <!-- End congrats -->
    <!-- GitHub: Show GitHub link (if specified) -->
    
    <section class="main-section">
        <div class="container" style="text-align:center;">
            <p>FORK THIS PROJECT ON GITHUB</p>
            <a href="https://github.com/inertia7/timeSeries_sp500_python" target="_blank">
            <img src="/static/img/github_2.png" alt="GitHub Repo Link" height="42" width="42">
            </a>
        </div>
    </section>    
    
    <!-- End GitHub -->
    <!-- Next Tutorial -->
    
    <section class="main-section">
        <div class="container" style="text-align:center;">
        <h3>Try this project next:</h3>
        <hr>
        <div id="next-tutorial" class="wow fadeInUp delay-04s animated">
            <a href="time-series-stock-market">
            
            <img src="/static/time-series-stock-market/wallStreet_2.png" alt="Forecasting the Stock Market">
            
            </a>
            <h3>Forecasting the Stock Market</h3>
            <p>Time-Series Analysis of the S&amp;P 500 Stock Index with R</p>
        </div>
        </div>
        </section>
    <!-- End Next Tutorial -->
    
<!-- END SUMMARY -->

<!-- Progress Bar -->
<script>
    wow = new WOW(
      {
        animateClass: 'animated',
        offset:       100
      }
    );
    wow.init();
    </script>
<script type="text/javascript">
    $(window).scroll(function () {
      var s = $(window).scrollTop(),
            d = $(document).height(),
            c = $(window).height();
            scrollPercent = (s / (d-c)) * 100;
            var position = scrollPercent;

       $("#progressbar").attr('value', position);

    });
</script>


<footer>
    <div>
        <a href="https://www.r-project.org/" target="_blank">DOWNLOAD R</a> | 
        <a href="https://www.rstudio.com/home/" target="_blank">DOWNLOAD R STUDIO</a> |
        <a href="../resources/" target="_blank">MORE RESOURCES</a>
    </div>
    <div id="copyright">
        <div><a href="#"><img src="/static/img/data_logo.png" alt=""></a></div>
        <span>Copyright &#169; 2016 | <a href="#">INERTIA7</a></span>
    </div>
</footer>
</body>

<script type="text/javascript">
    $(document).ready(function(e) {
        $('#test').scrollToFixed();
        $('.res-nav_click').click(function(){
            $('.main-nav').slideToggle();
            return false    
        });
    });
</script>

<script>
wow = new WOW(
  {
    animateClass: 'animated',
    offset:       100
  }
);
wow.init();
</script>

<script type="text/javascript">
	$(window).load(function(){
		
		$('.main-nav li a').bind('click',function(event){
			var $anchor = $(this);
			
			$('html, body').stop().animate({
				scrollTop: $($anchor.attr('href')).offset().top - 102
			}, 1500,'easeInOutExpo');
			/*
			if you don't want to use the easing effects:
			$('html, body').stop().animate({
				scrollTop: $($anchor.attr('href')).offset().top
			}, 1000);
			*/
			event.preventDefault();
		});
	})
</script>

<script type="text/javascript">
$(window).load(function(){
  
  var $container = $('.portfolioContainer'),
      $body = $('body'),
      colW = 375,
      columns = null;
 
  $container.isotope({
    // disable window resizing
    resizable: true,
    masonry: {
      columnWidth: colW
    }
  });
  
  $(window).smartresize(function(){
    // check if columns has changed
    var currentColumns = Math.floor( ( $body.width() -30 ) / colW );
    if ( currentColumns !== columns ) {
      // set new column count
      columns = currentColumns;
      // apply width to container manually, then trigger relayout
      $container.width( columns * colW )
        .isotope('reLayout');
    }
    
  }).smartresize(); // trigger resize to set container width
  $('.portfolioFilter a').click(function(){
        $('.portfolioFilter .current').removeClass('current');
        $(this).addClass('current');
 
        var selector = $(this).attr('data-filter');
        $container.isotope({
			
            filter: selector,
         });
         return false;
    });
});
</script>

<!-- GOOGLE ANALYTICS -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54935029-2', 'auto');
  ga('send', 'pageview');
</script>
<!-- [END] GOOGLE ANALYTICS -->

<script type="text/javascript">
    console.log("Hello! Thank you for visiting Inertia7.")
    console.log("You can find the source code for this project here: https://github.com/dcamposliz/inertia7")
</script>
</html>